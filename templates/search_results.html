{% extends "base.html" %}

{% block title %}Search Results for "{{ query }}"{% endblock %}

{% block content %}
    <h2>Search Results for "{{ query }}"</h2>

    {% if error %}
        <p class="error">An error occurred: {{ error }}</p>
        <p>Please ensure your `config.py` is correct and you have imported product data into your catalog.</p>
    {% elif results %}
        <div class="product-grid">
            {% for result in results %}
                <div class="product-card">
                    <a href="{{ url_for('product_detail', product_id=result.product.id) }}">
                        <img src="{{ (result.product.images[0].uri if result.product.images) or 'https://via.placeholder.com/200' }}" alt="{{ result.product.title or 'Untitled Product' }}">
                        <h3 class="product-title">{{ result.product.title or "Untitled Product" }}</h3>
                        {% if result.product.price_info and result.product.price_info.currency_code %}
                            <p class="price">${{ "%.2f"|format(result.product.price_info.price) }}</p>
                        {% else %}
                            <p class="price price-unavailable">Price not available</p>
                        {% endif %}
                    </a>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p>No products found for your query.</p>
    {% endif %}
{% endblock %}

{% block scripts %}
    {% if not error %}
        <script>
            window.addEventListener('load', function() {
                const searchResults = {{ results_json|tojson|safe }};
                const query = {{ query|tojson|safe }};
                VibeTracker.trackSearchView(query, searchResults);
            });
        </script>
    {% endif %}
{% endblock %}