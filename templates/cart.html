{% extends "base.html" %}

{% block title %}Your Shopping Cart{% endblock %}

{% block content %}
    <h2>Your Shopping Cart</h2>

    {% if not cart %}
        <p>Your cart is empty.</p>
        <a href="{{ url_for('index') }}">Continue Shopping</a>
    {% else %}
        <div class="cart-container">
            <div class="cart-items">
                {% for item in cart %}
                <div class="cart-item">
                    <img src="{{ item.image or 'https://via.placeholder.com/100' }}" alt="{{ item.title }}">
                    <div class="cart-item-info">
                        <h3>{{ item.title }}</h3>
                        <p>Quantity: {{ item.quantity }}</p>
                        <p>Price: ${{ "%.2f"|format(item.price) }}</p>
                    </div>
                    <div class="cart-item-actions">
                        <form action="{{ url_for('remove_from_cart', product_id=item.id) }}" method="post" onsubmit="VibeTracker.trackRemoveFromCart({{ item|tojson|safe }})">
                            <button type="submit" class="remove-button">Remove</button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
            <div class="cart-summary">
                <h3>Order Summary</h3>
                <p>Total: <strong>${{ "%.2f"|format(total) }}</strong></p>
                <form action="{{ url_for('checkout') }}" method="post">
                    <button type="submit" class="checkout-button">Proceed to Checkout</button>
                </form>
            </div>
        </div>
    {% endif %}
{% endblock %}

{% block scripts %}
<script>
    window.addEventListener('load', function() {
        const cartItems = {{ cart|tojson|safe }};
        VibeTracker.trackShoppingCartView(cartItems);
    });
</script>
{% endblock %}